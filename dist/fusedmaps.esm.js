function e(e,t){const n=window.cartocolor;if(!n)return null;const i=n[e];if(!i)return null;const o=Object.keys(i).map(Number).filter(e=>!isNaN(e)).sort((e,t)=>e-t),l=o.find(e=>e>=t)||o[o.length-1];return i[l]?[...i[l]]:null}function t(e,t){if(!Array.isArray(e)||e.length<3)return null;const[n,i,o]=e;return`rgba(${n},${i},${o},${e.length>=4?e[3]/255:t??1})`}const n=["#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#0868ac","#084081"],i=["#7F3C8D","#11A579","#3969AC","#F2B701","#E73F74","#80BA5A","#E68310","#008695","#CF1C90","#f97b72"];function o(t,n){if(!t)return null;if(Array.isArray(t))return null;if("string"==typeof t)return t;const o=t["@@function"],l=t.attr;return o&&l?"colorCategories"===o?function(t,n){let o=t.categories?t.categories.map(e=>"object"==typeof e?e:{value:e,label:String(e)}):function(e,t,n){const i=new Map;return(e||[]).forEach(e=>{const o=e?.[t]??e?.properties?.[t];if(null!=o&&""!==o&&"null"!==o&&!i.has(o)){const t=n?e?.[n]??e?.properties?.[n]??o:o;i.set(o,String(t))}}),[...i.entries()].sort((e,t)=>"number"==typeof e[0]&&"number"==typeof t[0]?e[0]-t[0]:String(e[0]).localeCompare(String(t[0]))).map(([e,t])=>({value:e,label:t}))}(n,t.attr,t.labelAttr);if(!o.length)return"rgba(128,128,128,0.5)";let l=e(t.colors||"Bold",Math.max(o.length,3));l&&l.length||(l=i);const r=t.nullColor?`rgb(${t.nullColor.slice(0,3).join(",")})`:"rgba(128,128,128,0.5)",a=["match",["get",t.attr]];return o.forEach((e,t)=>{a.push(e.value),a.push(l[t%l.length])}),a.push(r),t._detectedCategories=o,a}(t,n):"colorContinuous"===o?function(t){if(!t.domain?.length)return null;const[n,i]=t.domain,o=n>i,l=o?[i,n]:[n,i],r=t.steps||7;let a=e(t.colors||"TealGrn",r);if(!a||!a.length)return["interpolate",["linear"],["get",t.attr],l[0],"rgb(237,248,251)",l[1],"rgb(0,109,44)"];o&&a.reverse();const s=["interpolate",["linear"],["get",t.attr]];return a.forEach((e,t)=>{const n=l[0]+(l[1]-l[0])*t/(a.length-1);s.push(n),s.push(e)}),s}(t):null:null}function l(e){if(null==e)return null;try{if("string"==typeof e){const t=e.startsWith("0x")?e.slice(2):e;return/^\d+$/.test(t)?BigInt(t).toString(16):(/[a-f]/i.test(t),t.toLowerCase())}if("number"==typeof e)return BigInt(Math.trunc(e)).toString(16);if("bigint"==typeof e)return e.toString(16)}catch(e){}return null}const r={};let a=null;function s(n,i){const o=document.getElementById("layer-list");o&&(o.innerHTML=n.map(n=>{const o=!1!==i[n.id],l=function(n){let i="#0090ff";if("hex"===n.layerType){const o=n.hexLayer||{},l=!1===o.filled&&o.getLineColor?o.getLineColor:o.getFillColor;if(Array.isArray(l))i=t(l,1)||i;else if(l&&"object"==typeof l){const t=l["@@function"];if("colorContinuous"===t||"colorCategories"===t){const n=e(l.colors||("colorCategories"===t?"Bold":"TealGrn"),l.steps||7);n?.length&&(i=n[Math.floor(n.length/2)])}}}else if("vector"===n.layerType){const t=n;if(t.lineColorRgba&&!t.isFilled)i=t.lineColorRgba;else if(t.fillColorRgba)i=t.fillColorRgba;else if(t.fillColorConfig&&"object"==typeof t.fillColorConfig){const n=t.fillColorConfig.colors;if(n){const t=e(n,7);t?.length&&(i=t[Math.floor(t.length/2)])}}}return i}(n);return`\n      <div class="layer-item ${o?"":"disabled"}">\n        <input type="checkbox" ${o?"checked":""} \n               onchange="toggleLayerVisibility('${n.id}', this.checked)" />\n        <div class="layer-color" style="background:${l};"></div>\n        <span class="layer-name">${n.name}</span>\n      </div>\n    `}).join(""))}function c(t,o,l){const r=document.getElementById("color-legend");if(!r)return;const a=t.filter(e=>!1!==o[e.id]);if(!a.length)return void(r.style.display="none");let s="";a.forEach(t=>{const o=function(t){let o=null;if("hex"===t.layerType){const e=t.hexLayer||{};o=!1===e.filled&&e.getLineColor?e.getLineColor:e.getFillColor}else if("vector"===t.layerType){const e=t;if(o=e.fillColorConfig,!o?.["@@function"]&&e.lineColorRgba&&!e.isFilled)return`\n        <div class="legend-layer">\n          <div class="legend-title">\n            <span class="legend-line" style="background:${e.lineColorRgba};"></span>\n            ${t.name}\n          </div>\n        </div>\n      `}const l=o?.["@@function"];if(!l||!o?.attr)return"";if("colorContinuous"!==l&&"colorCategories"!==l)return"";const r=o.colors||("colorCategories"===l?"Bold":"TealGrn");return"colorCategories"===l?function(t,n,o){let l=n._detectedCategories||n.categories||[];if(l=l.map(e=>"object"==typeof e&&e.label?e:{value:e,label:e}),!l.length)return"";let r=e(o,Math.max(l.length,3));r?.length||(r=i);const a=n.labelAttr||n.attr;return`\n    <div class="legend-layer">\n      <div class="legend-title">\n        <span class="legend-dot" style="background:${r[0]};"></span>\n        ${t}: ${a}\n      </div>\n      <div class="legend-categories">\n        ${l.map((e,t)=>`\n          <div class="legend-cat-item">\n            <div class="legend-cat-swatch" style="background:${r[t%r.length]};"></div>\n            <span class="legend-cat-label" title="${e.label}">${e.label}</span>\n          </div>\n        `).join("")}\n      </div>\n    </div>\n  `}(t.name,o,r):"colorContinuous"===l?function(t,i,o){if(!i.domain?.length)return"";const[l,r]=i.domain,a=l>r;let s=e(o,i.steps||7);s?.length||(s=n),a&&(s=[...s].reverse());const c=`linear-gradient(to right, ${s.map((e,t)=>`${e} ${t/(s.length-1)*100}%`).join(", ")})`;return`\n    <div class="legend-layer">\n      <div class="legend-title">\n        <span class="legend-dot" style="background:${s[Math.floor(s.length/2)]};"></span>\n        ${t}: ${i.attr}\n      </div>\n      <div class="legend-gradient" style="background:${c};"></div>\n      <div class="legend-labels">\n        <span>${l.toFixed(1)}</span>\n        <span>${r.toFixed(1)}</span>\n      </div>\n    </div>\n  `}(t.name,o,r):""}(t);o&&(s+=o)}),s?(r.innerHTML=s,r.style.display="block"):r.style.display="none"}let d=!1,u=null;function y(e,t){let n={type:"FeatureCollection",features:[]};if(t){const e=t.properties||{},i=e.hex||e.h3;if(i&&window.h3)try{const t=l(i);if(t&&window.h3.isValidCell(t)){const i=window.h3.cellToBoundary(t).map(([e,t])=>[t,e]);i.push(i[0]),n.features.push({type:"Feature",geometry:{type:"Polygon",coordinates:[i]},properties:e})}}catch(e){}else t.geometry&&n.features.push({type:"Feature",geometry:t.geometry,properties:e})}d?e.getSource("feature-hl").setData(n):(e.addSource("feature-hl",{type:"geojson",data:n}),e.addLayer({id:"feature-hl-fill",type:"fill",source:"feature-hl",paint:{"fill-color":"rgba(255,255,0,0.3)","fill-opacity":1}}),e.addLayer({id:"feature-hl-line",type:"line",source:"feature-hl",paint:{"line-color":"rgba(255,255,0,1)","line-width":3}}),d=!0),u=t}function p(e){let t=null,n=null;try{"BroadcastChannel"in window&&(t=new BroadcastChannel(e))}catch(e){}function i(e){if(!n)return;let t;try{t="string"==typeof e.data?JSON.parse(e.data):e.data}catch{return}n(t)}return{send:function(e){const n=JSON.stringify(e);try{t&&t.postMessage(e)}catch(e){}try{window.parent.postMessage(n,"*")}catch(e){}try{window.top&&window.top!==window.parent&&window.top.postMessage(n,"*")}catch(e){}try{if(window.top?.frames)for(let e=0;e<window.top.frames.length;e++){const t=window.top.frames[e];if(t!==window)try{t.postMessage(n,"*")}catch(e){}}}catch(e){}},onMessage:function(e){n=e,t&&(t.onmessage=e=>{n&&n(e.data)}),window.addEventListener("message",i)},destroy:function(){t&&(t.close(),t=null),window.removeEventListener("message",i),n=null}}}function f(e="component"){return`${e}-${Math.random().toString(36).substr(2,9)}`}function g(e,t,n){t.broadcast?.enabled&&function(e,t={}){const n=t.channel||"fused-bus",i=t.dataset||"all",o=f("map-broadcast"),l=p(n);let r=null;function a(){const t=function(e){const t=e.getBounds();return[+t.getWest().toFixed(6),+t.getSouth().toFixed(6),+t.getEast().toFixed(6),+t.getNorth().toFixed(6)]}(e);if(a=r,(n=t)&&a&&n[0]===a[0]&&n[1]===a[1]&&n[2]===a[2]&&n[3]===a[3])return;var n,a;r=t;const[s,c,d,u]=t;l.send({type:"filter",fromComponent:o,timestamp:Date.now(),dataset:i,filter:{type:"spatial",field:"geometry",values:[s,c,d,u]}}),l.send({type:"spatial_filter",source:o,timestamp:Date.now(),bounds:{sw:{lng:s,lat:c},ne:{lng:d,lat:u}}})}e.on("move",a),e.on("moveend",a),e.on("load",()=>{setTimeout(a,300)}),e.loaded()&&setTimeout(a,100),setTimeout(()=>{l.send({type:"component_ready",componentType:"map",componentId:o,capabilities:["spatial_filter"],dataSource:"viewport",protocol:"unified"})},200)}(e,{channel:t.broadcast.channel,dataset:t.broadcast.dataset}),t.sync?.enabled&&function(e,t={}){let n=t.channel||"default";n.includes("::")||(n=`map-sync::${n}`);const i=f("map"),o=p(n);let l=!1,r=!1,a={x:NaN,y:NaN,z:NaN};const s=(e,t,n)=>Math.abs(e-t)<n;function c(){const t=e.getCenter();return{longitude:+t.lng.toFixed(6),latitude:+t.lat.toFixed(6),zoom:+e.getZoom().toFixed(3),bearing:+e.getBearing().toFixed(1),pitch:+e.getPitch().toFixed(1),id:i,ts:Date.now()}}function d(){if(l)return;const e=c(),{longitude:t,latitude:n,zoom:i}=e;s(t,a.x,1e-6)&&s(n,a.y,1e-6)&&s(i,a.z,.001)||(a={x:t,y:n,z:i},o.send({type:"sync",...e}))}let u=null;const y=()=>{r=!0},g=()=>{r&&(r=!1,d())};e.on("dragstart",y),e.on("zoomstart",y),e.on("rotatestart",y),e.on("pitchstart",y),e.on("moveend",g),e.on("move",()=>{r&&!l&&(u&&clearTimeout(u),u=setTimeout(d,0))}),o.onMessage(t=>{var n;"sync"===t.type&&t.id!==i&&(n=t)&&n.id!==i&&(l||r||(l=!0,e.jumpTo({center:[n.longitude,n.latitude],zoom:n.zoom,bearing:n.bearing,pitch:n.pitch}),requestAnimationFrame(()=>{l=!1})))}),e.on("load",()=>{setTimeout(()=>o.send({type:"sync",...c()}),100+100*Math.random())}),document.addEventListener("visibilitychange",()=>{document.hidden&&(l=!1,r=!1)})}(e,{channel:t.sync.channel}),t.clickBroadcast,t.locationListener}const h={};function m(e){const n=e.containerId||"map";e.layers.forEach(e=>{h[e.id]=!1!==e.visible});const i=function(e){const{containerId:t,mapboxToken:n,styleUrl:i,initialViewState:o}=e;return window.mapboxgl.accessToken=n,new window.mapboxgl.Map({container:t,style:i,center:[o.longitude,o.latitude],zoom:o.zoom,pitch:o.pitch||0,bearing:o.bearing||0,projection:"mercator"})}({containerId:n,mapboxToken:e.mapboxToken,styleUrl:e.styleUrl,initialViewState:e.initialViewState});let d=null;return!1!==e.ui?.layerPanel&&function(t,n){a=(t,n)=>{b(t,n,i,e)};let o=document.getElementById("layer-panel");o||(o=document.createElement("div"),o.id="layer-panel",o.innerHTML='\n      <h4>Layers</h4>\n      <div id="layer-list"></div>\n    ',document.body.appendChild(o)),window.toggleLayerVisibility=(e,t)=>{a&&a(e,t)},s(t,n)}(e.layers,h),!1!==e.ui?.legend&&function(e,t){let n=document.getElementById("color-legend");n||(n=document.createElement("div"),n.id="color-legend",n.className="color-legend",n.style.display="none",document.body.appendChild(n)),c(e,t)}(e.layers,h),!1!==e.ui?.tooltip&&function(e,t,n){let i=document.getElementById("tooltip");i||(i=document.createElement("div"),i.id="tooltip",document.body.appendChild(i));const o=[];t.forEach(e=>{if(e.isTileLayer)return;const t=[];"hex"===e.layerType?((e.hexLayer||{}).extruded?t.push(`${e.id}-extrusion`):t.push(`${e.id}-fill`),t.push(`${e.id}-outline`)):"vector"===e.layerType?t.push(`${e.id}-fill`,`${e.id}-outline`,`${e.id}-circle`,`${e.id}-line`):"mvt"===e.layerType&&t.push(`${e.id}-fill`,`${e.id}-line`,`${e.id}-extrusion`),t.forEach(t=>{o.push({layerId:t,layerDef:e})})}),e.on("mousemove",t=>{const l=o.map(e=>e.layerId).filter(t=>e.getLayer(t));if(!l.length)return;const r=e.queryRenderedFeatures(t.point,{layers:l});if(!r?.length)return i.style.display="none",void(e.getCanvas().style.cursor="");let a=null,s=null;for(const e of r){const t=o.find(t=>t.layerId===e.layer?.id);if(t&&!1!==n[t.layerDef.id]){a=e,s=t.layerDef;break}}if(!a||!s)return i.style.display="none",void(e.getCanvas().style.cursor="");e.getCanvas().style.cursor="pointer";const c=(d=a.properties||{},(u=function(e){if("hex"===e.layerType){const t=e;return t.hexLayer?.tooltipColumns||t.hexLayer?.tooltipAttrs||t.tooltipColumns||[]}if("vector"===e.layerType){const t=e;return t.vectorLayer?.tooltipColumns||t.vectorLayer?.tooltipAttrs||t.tooltipColumns||[]}return e.tooltipColumns||[]}(s)).length?u.map(e=>{const t=d[e];return null==t?"":`<span class="tt-row"><span class="tt-key">${e}</span><span class="tt-val">${"number"==typeof t?t.toFixed(2):String(t)}</span></span>`}).filter(Boolean):d.hex?[`<span class="tt-row"><span class="tt-key">hex</span><span class="tt-val">${String(d.hex).slice(0,12)}...</span></span>`]:Object.keys(d).slice(0,5).map(e=>`<span class="tt-row"><span class="tt-key">${e}</span><span class="tt-val">${d[e]}</span></span>`));var d,u;c.length?(i.innerHTML=`<strong class="tt-title">${s.name}</strong>`+c.join(""),i.style.left=`${t.point.x+10}px`,i.style.top=`${t.point.y+10}px`,i.style.display="block"):i.style.display="none"}),e.on("mouseleave",()=>{e.getCanvas().style.cursor="",i.style.display="none"})}(i,e.layers,h),i.on("load",()=>{const n=function(e,n,i){return function(e,t){t.forEach(t=>{[`${t.id}-fill`,`${t.id}-extrusion`,`${t.id}-outline`,`${t.id}-circle`,`${t.id}-line`,`${t.id}-raster`].forEach(t=>{try{e.getLayer(t)&&e.removeLayer(t)}catch(e){}});try{e.getSource(t.id)&&e.removeSource(t.id)}catch(e){}})}(e,n),[...n].reverse().forEach(n=>{const a=!1!==i[n.id];switch(n.layerType){case"hex":{const i=n;if(i.isTileLayer);else if(i.data?.length){const s=function(e){const t=[];for(const n of e){const e=l(n.hex??n.h3??n.index??n.id);if(e&&window.h3?.isValidCell(e))try{const i=window.h3.cellToBoundary(e).map(([e,t])=>[t,e]);i.push(i[0]),t.push({type:"Feature",properties:{...n,hex:e},geometry:{type:"Polygon",coordinates:[i]}})}catch(e){}}return{type:"FeatureCollection",features:t}}(i.data);r[n.id]=s,function(e,n,i,l){const r=n.hexLayer||{},a=n.data||[];e.addSource(n.id,{type:"geojson",data:i});const s=Array.isArray(r.getFillColor)?t(r.getFillColor,.8):o(r.getFillColor,a)||"rgba(0,144,255,0.7)",c=r.getLineColor?Array.isArray(r.getLineColor)?t(r.getLineColor,1):o(r.getLineColor,a):"rgba(255,255,255,0.3)",d="number"==typeof r.opacity&&isFinite(r.opacity)?Math.max(0,Math.min(1,r.opacity)):.8;if(r.extruded){const t=r.elevationScale||1;e.addLayer({id:`${n.id}-extrusion`,type:"fill-extrusion",source:n.id,paint:{"fill-extrusion-color":s,"fill-extrusion-height":r.getFillColor?.attr?["*",["get",r.getFillColor.attr],t]:100,"fill-extrusion-base":0,"fill-extrusion-opacity":d},layout:{visibility:l?"visible":"none"}})}else!1!==r.filled&&e.addLayer({id:`${n.id}-fill`,type:"fill",source:n.id,paint:{"fill-color":s,"fill-opacity":d},layout:{visibility:l?"visible":"none"}});e.addLayer({id:`${n.id}-outline`,type:"line",source:n.id,paint:{"line-color":c,"line-width":r.lineWidthMinPixels||.5},layout:{visibility:l?"visible":"none"}})}(e,i,s,a)}break}case"vector":{const t=n;t.geojson&&(r[n.id]=t.geojson,function(e,t,n){const i=t.geojson;if(!i?.features?.length)return;e.addSource(t.id,{type:"geojson",data:i});const l=i.features.map(e=>e.properties||{}),r=t.fillColorConfig?.["@@function"]?o(t.fillColorConfig,l):t.fillColorRgba||"rgba(0,144,255,0.6)",a=t.lineColorConfig?.["@@function"]?o(t.lineColorConfig,l):t.lineColorRgba||"rgba(100,100,100,0.8)",s="number"==typeof t.lineWidth&&isFinite(t.lineWidth)?t.lineWidth:1,c="number"==typeof t.opacity&&isFinite(t.opacity)?Math.max(0,Math.min(1,t.opacity)):.8;let d=!1,u=!1,y=!1;for(const e of i.features){const t=e.geometry?.type;"Point"!==t&&"MultiPoint"!==t||(u=!0),"Polygon"!==t&&"MultiPolygon"!==t||(d=!0),"LineString"!==t&&"MultiLineString"!==t||(y=!0)}d&&(!1!==t.isFilled&&e.addLayer({id:`${t.id}-fill`,type:"fill",source:t.id,paint:{"fill-color":r,"fill-opacity":c},filter:["any",["==",["geometry-type"],"Polygon"],["==",["geometry-type"],"MultiPolygon"]],layout:{visibility:n?"visible":"none"}}),!1!==t.isStroked&&e.addLayer({id:`${t.id}-outline`,type:"line",source:t.id,layout:{"line-join":"round","line-cap":"round",visibility:n?"visible":"none"},paint:{"line-color":a,"line-width":s},filter:["any",["==",["geometry-type"],"Polygon"],["==",["geometry-type"],"MultiPolygon"]]})),y&&e.addLayer({id:`${t.id}-line`,type:"line",source:t.id,layout:{"line-join":"round","line-cap":"round",visibility:n?"visible":"none"},paint:{"line-color":a,"line-width":s,"line-opacity":1},filter:["any",["==",["geometry-type"],"LineString"],["==",["geometry-type"],"MultiLineString"]]}),u&&e.addLayer({id:`${t.id}-circle`,type:"circle",source:t.id,paint:{"circle-radius":t.pointRadius||6,"circle-color":r,"circle-stroke-color":"rgba(0,0,0,0.5)","circle-stroke-width":1,"circle-opacity":.9},filter:["any",["==",["geometry-type"],"Point"],["==",["geometry-type"],"MultiPoint"]],layout:{visibility:n?"visible":"none"}})}(e,t,a));break}case"mvt":!function(e,t,n){const i=t.sourceLayer||"udf";e.addSource(t.id,{type:"vector",tiles:[t.tileUrl],minzoom:t.minzoom||0,maxzoom:t.maxzoom||22});const o=t.fillColor||"#FFF5CC",l=t.lineColor||"#FFFFFF",r=t.fillOpacity??.8,a=t.lineWidth??1;!1!==t.isFilled&&e.addLayer({id:`${t.id}-fill`,type:"fill",source:t.id,"source-layer":i,paint:{"fill-color":o,"fill-opacity":r},layout:{visibility:n?"visible":"none"}}),e.addLayer({id:`${t.id}-line`,type:"line",source:t.id,"source-layer":i,paint:{"line-color":l,"line-width":a},layout:{visibility:n?"visible":"none"}}),t.isExtruded&&e.addLayer({id:`${t.id}-extrusion`,type:"fill-extrusion",source:t.id,"source-layer":i,paint:{"fill-extrusion-color":o,"fill-extrusion-height":["*",["get",t.heightProperty||"height"],t.heightMultiplier||1],"fill-extrusion-base":0,"fill-extrusion-opacity":t.extrusionOpacity??.9},layout:{visibility:n?"visible":"none"}})}(e,n,a);break;case"raster":!function(e,t,n){const i=t.opacity??t.rasterLayer?.opacity??1;e.addSource(t.id,{type:"raster",tiles:[t.tileUrl],tileSize:256}),e.addLayer({id:`${t.id}-raster`,type:"raster",source:t.id,paint:{"raster-opacity":Math.max(0,Math.min(1,i))},layout:{visibility:n?"visible":"none"}})}(e,n,a)}}),{deckOverlay:null}}(i,e.layers,h);d=n.deckOverlay,s(e.layers,h),c(e.layers,h),!1!==e.highlightOnClick&&function(e,t,n,i){e.on("click",n=>{const o=function(e,t){const n=[];return t.forEach(t=>{if(t.isTileLayer)return;const i=t.layerType;let o=[];if("vector"===i)o=[`${t.id}-fill`,`${t.id}-circle`,`${t.id}-line`];else if("hex"===i){const e=t;o=[e.hexLayer?.extruded?`${t.id}-extrusion`:`${t.id}-fill`]}o.forEach(t=>{try{e.getLayer(t)&&n.push(t)}catch(e){}})}),["gdf-fill","gdf-circle","hex-fill"].forEach(t=>{try{e.getLayer(t)&&n.push(t)}catch(e){}}),n}(e,t);if(!o.length)return;let l=[];try{l=e.queryRenderedFeatures(n.point,{layers:o})||[]}catch(e){}if(l.length>0)y(e,l[0]);else if(i){const t=i?.pickObject?.({x:n.point.x,y:n.point.y,radius:4});t?.object?y(e,{properties:t.object.properties||t.object,geometry:null}):u&&y(e,null)}else u&&y(e,null)})}(i,e.layers,0,d),e.messaging&&g(i,e.messaging,e.layers),e.hasCustomView||function(e,t){const n=new mapboxgl.LngLatBounds,i=r;t.forEach(e=>{if(e.isTileLayer)return;const t=i[e.id];t?.features?.length&&t.features.forEach(e=>{"Point"===e.geometry?.type?n.extend(e.geometry.coordinates):"Polygon"===e.geometry?.type||"MultiPolygon"===e.geometry?.type?("Polygon"===e.geometry.type?[e.geometry.coordinates]:e.geometry.coordinates).forEach(e=>e[0]?.forEach(e=>n.extend(e))):"LineString"===e.geometry?.type&&e.geometry.coordinates.forEach(e=>n.extend(e))})}),n.isEmpty()||e.fitBounds(n,{padding:50,maxZoom:15,duration:500})}(i,e.layers)}),i.on("load",()=>{[100,500,1e3].forEach(e=>setTimeout(()=>i.resize(),e))}),window.addEventListener("resize",()=>i.resize()),document.addEventListener("visibilitychange",()=>{document.hidden||setTimeout(()=>i.resize(),100)}),{map:i,deckOverlay:d,setLayerVisibility:(t,n)=>{b(t,n,i,e)},updateLegend:()=>{c(e.layers,h)},destroy:()=>{i.remove?.()}}}function b(e,t,n,i,o){h[e]=t,function(e,t,n,i){const o=i.find(e=>e.id===t);if(o)switch(o.layerType){case"hex":{const i=o;i.isTileLayer||function(e,t,n,i){(i?[`${t}-extrusion`,`${t}-outline`]:[`${t}-fill`,`${t}-outline`]).forEach(t=>{try{e.getLayer(t)&&e.setLayoutProperty(t,"visibility",n?"visible":"none")}catch(e){}})}(e,t,n,!0===i.hexLayer?.extruded);break}case"vector":case"mvt":!function(e,t,n){[`${t}-fill`,`${t}-outline`,`${t}-line`,`${t}-circle`,`${t}-extrusion`].forEach(t=>{try{e.getLayer(t)&&e.setLayoutProperty(t,"visibility",n?"visible":"none")}catch(e){}})}(e,t,n);break;case"raster":!function(e,t,n){const i=`${t}-raster`;try{e.getLayer(i)&&e.setLayoutProperty(i,"visibility",n?"visible":"none")}catch(e){}}(e,t,n)}}(n,e,t,i.layers),s(i.layers,h),c(i.layers,h)}"undefined"!=typeof window&&(window.FusedMaps={init:m});var v={init:m};export{v as default,m as init};
//# sourceMappingURL=fusedmaps.esm.js.map
